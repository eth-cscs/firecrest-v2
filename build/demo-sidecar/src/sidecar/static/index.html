<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wizard Example</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .step { display: none; }
        .active { display: block; }
        .buttons { margin-top: 10px; }
    </style>
</head>
<body>

    <div id="step1" class="step active">
        <h2>Step 1: Set-up your SSH Credentials</h2>
        <label for="username">Username:</label><br>
        <input type="text" id="username" placeholder="Enter your username" required><br>
        <br>
        <label for="private_key">Private key:</label><br>
        <textarea id="private_key"  rows="4" cols="50" placeholder="Enter ssh private key" required></textarea><br>
        <br>
        <label for="public_cert">Public certificate: [Optional]</label><br>
        <textarea id="public_cert"  rows="4" cols="50" placeholder="Enter ssh public certificate"></textarea><br>
        <br>
        <div class="buttons">
            <button onclick="submitCredentials()">Next</button>
        </div>
    </div>

    <div id="step2" class="step">
        <h2>Step 2: Set-up your SSH Connection</h2>
        <label for="hostname">SSH Hostname:</label><br>
        <input type="text" id="hostname" placeholder="Enter your SSH hostname" required><br>
        <br>
        <label for="hostport">SSH Port:</label><br>
        <input type="text" id="hostport" value="22" required><br>
        <br>
        <label for="proxyhost">SSH Proxy Hostname: [Optional]</label><br>
        <input type="text" id="proxyhost" placeholder="Enter your SSH proxy hostname"><br>
        <br>
        <label for="proxyport">SSH Proxy Port: [Optional]</label><br>
        <input type="text" id="proxyport" placeholder="Enter your SSH proxy port"><br>
        <br>
        <div class="buttons">
            <button onclick="showStep(1)">Back</button>
            <button onclick="submitSSHConnection()">Next</button>
        </div>
    </div>

    <div id="step3" class="step">
        <h2>Step 3: Setup your Scheduler</h2>
        <label for="scheduler">Scheduler type:</label>
        <select id="scheduler" name="scheduler">
          <option value="slurm">Slurm</option>
          <option value="openPBS" disabled>openPBS (not available on playground)</option>
          <option value="hyperQueue" disabled>HyperQueue (not available on playground)</option>
        </select>
        <div class="buttons">
            <button onclick="showStep(2)">Back</button>
            <button onclick="bootPlayground()">Next</button>
        </div>
    </div>

    <div id="step4" class="step">
        <h2>Step 4: Access your Firecrest playground</h2>

        <p>Your Firecrest v2 instance is up and running!</p>

        <p>The API documentation (swagger) is available at <span>http://localhost:8000/docs</span></p>
        
        <p>Your JWT access token is:</p>
        <textarea id="token"  rows="4" cols="50"></textarea><br>

        <h2>API call examples</h2>
        <code>curl --header "Authorization: Bearer <span id="token-example"></span>" "http://localhost:8000/filesystem/cluster/ops/ls?path=<span id="user-home"></span>"</code>
    </div>

    <script>

        async function submitCredentials() {
            const username = document.getElementById('username').value;
            const private_key = document.getElementById('private_key').value;
            const public_cert = document.getElementById('public_cert').value;

            const response = await fetch('/credentials', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ "username":username, "private_key":private_key,"public_cert":public_cert })
            });

            if (response.ok) {
                alert('Submitted successfully!');
                showStep(2)
            } else {
                error = await response.json()
                console.log(error);
                alert('Invalid SSH credentials: ' + error.detail);
            }
        }

        async function submitSSHConnection() {
            const hostname = document.getElementById('hostname').value;
            const hostport = document.getElementById('hostport').value;
            var proxyhost = document.getElementById('proxyhost').value;
            var proxyport = document.getElementById('proxyport').value;

            if (proxyhost.length === 0) {
                proxyhost = null
                proxyport = null
            }    

            const response = await fetch('/sshconnection', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ "hostname":hostname, "hostport":hostport,"proxyhost":proxyhost,"proxyport":proxyport })
            });

            if (response.ok) {
                response_json = await response.json()
                document.getElementById("user-home").textContent=response_json.user_home;
                alert('Submitted successfully!');
                showStep(3)
            } else {
                error = await response.json()
                console.log(error);
                alert('Invalid SSH credentials: ' + error.detail);
            }
        }

        async function bootPlayground() {
          

            const response = await fetch('/boot', {
                method: 'GET'
            });

            if (response.ok) {
                response_json = await response.json()
                document.getElementById("token").value=response_json.access_token;
                document.getElementById("token-example").textContent=response_json.access_token;
                alert('Submitted successfully!');
                showStep(4)
            } else {
                error = await response.json()
                console.log(error);
                alert('Invalid SSH credentials: ' + error.detail);
            }
        }




        function showStep(step) {
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
        }

       
        async function submitForm() {
            const name = document.getElementById('name').value;
            const option = document.getElementById('option').value;

            const response = await fetch('https://your-api.com/submit', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, option })
            });

            if (response.ok) {
                alert('Submitted successfully!');
            } else {
                alert('Error submitting.');
            }
        }
    </script>

</body>
</html>